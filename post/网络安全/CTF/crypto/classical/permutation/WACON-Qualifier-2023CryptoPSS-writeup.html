<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="">
<meta name="description"
    content="tags: ctf,crypto,writeup,permutation,brute
 WACON-Qualifier-2023/Crypto/PSS writeup 1. challenge  PSS = Permutation Secret Sharing
for_user.zip
 pss_data 是个3M大小的数据文件
prob.py
from Crypto.Util.number import * import os from hashlib import sha256 from tqdm import tqdm def cascade_hash(msg, cnt, digest_len): assert digest_len &amp;lt;= 32 msg = msg * 10 for _ in range(cnt): msg = sha256(msg).digest() return msg[:digest_len] def seed_to_permutation(seed): permutation = &amp;#39;&amp;#39; msg = seed &#43; b&amp;#34;_shuffle&amp;#34; while len(permutation) &amp;lt; 16: msg = cascade_hash(msg, 777, 32) msg_hex = msg." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/post/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/CTF/crypto/classical/permutation/WACON-Qualifier-2023CryptoPSS-writeup.html" />


<title>
    
    WACON-Qualifier-2023/Crypto/PSS writeup :: welcome to st0n3&#39;s blog 
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.de959d61dd13c2cd41136acd491ffb0749779e1afe37b1fed6d5cba0b7e1938d.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="WACON-Qualifier-2023/Crypto/PSS writeup">
<meta itemprop="description" content="tags: ctf,crypto,writeup,permutation,brute
 WACON-Qualifier-2023/Crypto/PSS writeup 1. challenge  PSS = Permutation Secret Sharing
for_user.zip
 pss_data 是个3M大小的数据文件
prob.py
from Crypto.Util.number import * import os from hashlib import sha256 from tqdm import tqdm def cascade_hash(msg, cnt, digest_len): assert digest_len &lt;= 32 msg = msg * 10 for _ in range(cnt): msg = sha256(msg).digest() return msg[:digest_len] def seed_to_permutation(seed): permutation = &#39;&#39; msg = seed &#43; b&#34;_shuffle&#34; while len(permutation) &lt; 16: msg = cascade_hash(msg, 777, 32) msg_hex = msg.">
<meta itemprop="datePublished" content="2023-09-04T09:13:02+00:00" />
<meta itemprop="dateModified" content="2023-09-04T09:13:02+00:00" />
<meta itemprop="wordCount" content="744">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WACON-Qualifier-2023/Crypto/PSS writeup"/>
<meta name="twitter:description" content="tags: ctf,crypto,writeup,permutation,brute
 WACON-Qualifier-2023/Crypto/PSS writeup 1. challenge  PSS = Permutation Secret Sharing
for_user.zip
 pss_data 是个3M大小的数据文件
prob.py
from Crypto.Util.number import * import os from hashlib import sha256 from tqdm import tqdm def cascade_hash(msg, cnt, digest_len): assert digest_len &lt;= 32 msg = msg * 10 for _ in range(cnt): msg = sha256(msg).digest() return msg[:digest_len] def seed_to_permutation(seed): permutation = &#39;&#39; msg = seed &#43; b&#34;_shuffle&#34; while len(permutation) &lt; 16: msg = cascade_hash(msg, 777, 32) msg_hex = msg."/>




<meta property="article:published_time" content="2023-09-04 09:13:02 &#43;0000 UTC" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/st0n3</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/aboutme.html">About</a></li><li><a href="/post.html">Blog</a></li><li><a href="/hackerbot">Hackerbot</a></li><li><a href="/skill_tree/">SkillTree</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="/post/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/CTF/crypto/classical/permutation/WACON-Qualifier-2023CryptoPSS-writeup.html">WACON-Qualifier-2023/Crypto/PSS writeup</a></h2>

            

            <div class="post-content">
                <hr>
<p>tags: ctf,crypto,writeup,permutation,brute</p>
<hr>
<h1 id="wacon-qualifier-2023cryptopss-writeup">WACON-Qualifier-2023/Crypto/PSS writeup</h1>
<h2 id="1-challenge">1. challenge</h2>
<blockquote>
<p>PSS = Permutation Secret Sharing</p>
<p><a href="https://global.wacon.world/files/19cafd04fee68680707c0f29459da516/for_user.zip">for_user.zip</a></p>
</blockquote>
<p>pss_data 是个3M大小的数据文件</p>
<p><code>prob.py</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">import</span> os
<span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> sha256
<span style="color:#f92672">from</span> tqdm <span style="color:#f92672">import</span> tqdm

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cascade_hash</span>(msg, cnt, digest_len):
    <span style="color:#66d9ef">assert</span> digest_len <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">32</span>
    msg <span style="color:#f92672">=</span> msg <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>
    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(cnt):
        msg <span style="color:#f92672">=</span> sha256(msg)<span style="color:#f92672">.</span>digest()
    <span style="color:#66d9ef">return</span> msg[:digest_len]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">seed_to_permutation</span>(seed):
    permutation <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
    msg <span style="color:#f92672">=</span> seed <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;_shuffle&#34;</span>
    <span style="color:#66d9ef">while</span> len(permutation) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>:
        msg <span style="color:#f92672">=</span> cascade_hash(msg, <span style="color:#ae81ff">777</span>, <span style="color:#ae81ff">32</span>)
        msg_hex <span style="color:#f92672">=</span> msg<span style="color:#f92672">.</span>hex()
        <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> msg_hex:
            <span style="color:#66d9ef">if</span> c <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> permutation:
                permutation <span style="color:#f92672">+=</span> c

    <span style="color:#66d9ef">return</span> permutation

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">permutation_secret_sharing_gen</span>(secret):
    seed_len <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
    master_seed <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(seed_len)
    seed_tree <span style="color:#f92672">=</span> [None] <span style="color:#f92672">*</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    seed_tree[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> master_seed
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        h <span style="color:#f92672">=</span> cascade_hash(seed_tree[i], <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> seed_len)
        seed_tree[<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>], seed_tree[<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> h[:seed_len], h[seed_len:]
    
    secret_list <span style="color:#f92672">=</span> list(secret<span style="color:#f92672">.</span>decode()) <span style="color:#75715e"># ex) [&#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,...]</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(N):
        <span style="color:#75715e"># i-th party has a permutation derived from seed_tree[i+N-1]</span>
        permutation <span style="color:#f92672">=</span> seed_to_permutation(seed_tree[i <span style="color:#f92672">+</span> N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>])
        secret_list <span style="color:#f92672">=</span> [hex(permutation<span style="color:#f92672">.</span>find(x))[<span style="color:#ae81ff">2</span>:] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> secret_list]

    permutated_secret <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(secret_list)
    hidden_party <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">7</span>
    proof_idxs <span style="color:#f92672">=</span> merkle_proof_indexes[hidden_party]

    <span style="color:#66d9ef">return</span> seed_tree[proof_idxs[<span style="color:#ae81ff">0</span>]] <span style="color:#f92672">+</span> \
           seed_tree[proof_idxs[<span style="color:#ae81ff">1</span>]] <span style="color:#f92672">+</span> \
           seed_tree[proof_idxs[<span style="color:#ae81ff">2</span>]] <span style="color:#f92672">+</span> \
           bytes([hidden_party]) <span style="color:#f92672">+</span> \
           bytes<span style="color:#f92672">.</span>fromhex(permutated_secret)

merkle_proof_indexes <span style="color:#f92672">=</span> {
    <span style="color:#ae81ff">0</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">8</span>],
    <span style="color:#ae81ff">1</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">7</span>],
    <span style="color:#ae81ff">2</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">10</span>],
    <span style="color:#ae81ff">3</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">9</span>],
    <span style="color:#ae81ff">4</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">12</span>],
    <span style="color:#ae81ff">5</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">11</span>],
    <span style="color:#ae81ff">6</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">14</span>],
    <span style="color:#ae81ff">7</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">13</span>]
}


N <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span> <span style="color:#75715e"># Number of parties</span>

secret <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;---REDACTED---&#39;</span>
flag <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;WACON2023{&#34;</span> <span style="color:#f92672">+</span> secret <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;}&#39;</span>

<span style="color:#66d9ef">assert</span> len(secret) <span style="color:#f92672">==</span> <span style="color:#ae81ff">16</span> <span style="color:#f92672">and</span> set(secret) <span style="color:#f92672">==</span> set(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;0123456789abcdef&#34;</span>)
<span style="color:#75715e"># You can bruteforce the secret directly if you can overcome ^^^O(0xbeeeef * 16!)^^^!!!</span>
<span style="color:#66d9ef">assert</span> cascade_hash(flag, <span style="color:#ae81ff">0xbeeeef</span>, <span style="color:#ae81ff">32</span>)<span style="color:#f92672">.</span>hex() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;f7a5108a576391671fe3231040777e9ac455d1bb8b84a16b09be1b2bac68345c&#39;</span>

fw <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;pss_data&#34;</span>, <span style="color:#e6db74">&#34;wb&#34;</span>)
<span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> tqdm(range(<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">17</span>)):
    fw<span style="color:#f92672">.</span>write(permutation_secret_sharing_gen(secret))

fw<span style="color:#f92672">.</span>close()
</code></pre></div><h2 id="2-分析">2. 分析</h2>
<p>基于 Permutation 实现了秘密共享方案。</p>
<p>由 master_seed 派生 seed_tree，由 seed_tree 派生 permutation，secret 经 permutation 置换。</p>
<p>master_seed -&gt; seed_tree -&gt; permutation, secret -&gt; permutated_secret</p>
<p>如果知道 master_seed , 则问题易解。</p>
<p>master_seed 是长度为5的随机字符串，需要爆破 $2^{40}$ 次，难以爆破。</p>
<p>但我们有 $2^{17}$ 组数据，则实际的时间复杂度约为 $O(2^{23})$ ，可以爆破。</p>
<p>master_seed 生成 seed_tree, 可用于校验爆破是否正确。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">seed_len <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
N <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>

merkle_proof_indexes <span style="color:#f92672">=</span> {
    <span style="color:#ae81ff">0</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">8</span>],
    <span style="color:#ae81ff">1</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">7</span>],
    <span style="color:#ae81ff">2</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">10</span>],
    <span style="color:#ae81ff">3</span> : [<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">9</span>],
    <span style="color:#ae81ff">4</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">12</span>],
    <span style="color:#ae81ff">5</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">6</span>,<span style="color:#ae81ff">11</span>],
    <span style="color:#ae81ff">6</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">14</span>],
    <span style="color:#ae81ff">7</span> : [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">13</span>]
}
pss_data <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;pss_data&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>)<span style="color:#f92672">.</span>read()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_single</span>(base):
    hidden_party <span style="color:#f92672">=</span> pss_data[base <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>seed_len]
    idx <span style="color:#f92672">=</span> merkle_proof_indexes[hidden_party]
    known_seed <span style="color:#f92672">=</span> [pss_data[base <span style="color:#f92672">+</span> i<span style="color:#f92672">*</span>seed_len: base <span style="color:#f92672">+</span> (i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>seed_len] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>)]
    permutated_secret <span style="color:#f92672">=</span> pss_data[base <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>seed_len <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>: base <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>seed_len <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>]
    <span style="color:#66d9ef">return</span> known_seed, idx, permutated_secret

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_data</span>():
    known_seeds <span style="color:#f92672">=</span> {i:set() <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">3</span>)}
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">17</span>):
        base <span style="color:#f92672">=</span> i <span style="color:#f92672">*</span> (<span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>seed_len <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">8</span>)
        known_seed, idx, _ <span style="color:#f92672">=</span> parse_single(base)
        known_seeds[idx[<span style="color:#ae81ff">0</span>]]<span style="color:#f92672">.</span>add(known_seed[<span style="color:#ae81ff">0</span>])
    <span style="color:#66d9ef">return</span> known_seeds

known_seeds <span style="color:#f92672">=</span> parse_data()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os
<span style="color:#f92672">from</span> hashlib <span style="color:#f92672">import</span> sha256

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cascade_hash</span>(msg, cnt, digest_len):
    <span style="color:#66d9ef">assert</span> digest_len <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">32</span>
    msg <span style="color:#f92672">=</span> msg <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>
    <span style="color:#66d9ef">for</span> _ <span style="color:#f92672">in</span> range(cnt):
        msg <span style="color:#f92672">=</span> sha256(msg)<span style="color:#f92672">.</span>digest()
    <span style="color:#66d9ef">return</span> msg[:digest_len]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">seed_tree_gen</span>(master_seed):
    seed_tree <span style="color:#f92672">=</span> [None] <span style="color:#f92672">*</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
    seed_tree[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> master_seed
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
        h <span style="color:#f92672">=</span> cascade_hash(seed_tree[i], <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> seed_len)
        seed_tree[<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>], seed_tree[<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> h[:seed_len], h[seed_len:]
    <span style="color:#66d9ef">return</span> seed_tree

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check</span>(master_seed, seed):
    base <span style="color:#f92672">=</span> pss_data<span style="color:#f92672">.</span>index(seed)
    known_seed, idx, _ <span style="color:#f92672">=</span> parse_single(base)
    seed_tree <span style="color:#f92672">=</span> seed_tree_gen(master_seed)
    <span style="color:#66d9ef">return</span> [seed_tree[idx[i]] <span style="color:#f92672">==</span> known_seed[i] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(idx))] <span style="color:#f92672">==</span> [True, True, True]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">crack</span>():
    master_seed <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(seed_len)
    h <span style="color:#f92672">=</span> cascade_hash(master_seed, <span style="color:#ae81ff">123</span>, <span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> seed_len)
    h1, h2 <span style="color:#f92672">=</span> h[:seed_len], h[seed_len:]
    seed1 <span style="color:#f92672">=</span> None
    <span style="color:#66d9ef">if</span> h1 <span style="color:#f92672">in</span> known_seeds[<span style="color:#ae81ff">1</span>]:
        seed1 <span style="color:#f92672">=</span> h1
    <span style="color:#66d9ef">if</span> h2 <span style="color:#f92672">in</span> known_seeds[<span style="color:#ae81ff">2</span>]:
        seed1 <span style="color:#f92672">=</span> h2
    <span style="color:#66d9ef">if</span> seed1 <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:        
        <span style="color:#66d9ef">if</span> check(master_seed, seed1):
            <span style="color:#75715e"># print(&#34;master_seed:&#34;, master_seed, flush=True)</span>
            <span style="color:#66d9ef">return</span> master_seed, seed1
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tqdm.auto <span style="color:#f92672">import</span> tqdm
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> multiprocessing

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">crack_</span>(_):
    <span style="color:#66d9ef">return</span> crack()

ncpus <span style="color:#f92672">=</span> multiprocessing<span style="color:#f92672">.</span>cpu_count()
pool <span style="color:#f92672">=</span> multiprocessing<span style="color:#f92672">.</span>Pool(processes<span style="color:#f92672">=</span>ncpus<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
iter_pool <span style="color:#f92672">=</span> pool<span style="color:#f92672">.</span>imap(crack_, range(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">23</span>), chunksize<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>ncpus)

s <span style="color:#f92672">=</span> None
iter_tqdm <span style="color:#f92672">=</span> tqdm(iter_pool, total<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">23</span>)
<span style="color:#66d9ef">for</span> r <span style="color:#f92672">in</span> iter_tqdm:
    <span style="color:#66d9ef">if</span> r <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        iter_tqdm<span style="color:#f92672">.</span>close()
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Found, exiting brute.&#34;</span>, flush<span style="color:#f92672">=</span>True)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;master_seed:&#34;</span>, r[<span style="color:#ae81ff">0</span>], flush<span style="color:#f92672">=</span>True)
        pool<span style="color:#f92672">.</span>close()
        pool<span style="color:#f92672">.</span>terminate()
        s <span style="color:#f92672">=</span> r
        <span style="color:#66d9ef">break</span>
</code></pre></div><pre><code>  6%|          | 531849/8388608 [00:19&lt;04:46, 27429.81it/s]


Found, exiting brute.
master_seed: b'{\x7f\x08\xd7H'
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">seed2flag</span>(master_seed, seed1):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">seed_to_permutation</span>(seed):
        permutation <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
        msg <span style="color:#f92672">=</span> seed <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;_shuffle&#34;</span>
        <span style="color:#66d9ef">while</span> len(permutation) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">16</span>:
            msg <span style="color:#f92672">=</span> cascade_hash(msg, <span style="color:#ae81ff">777</span>, <span style="color:#ae81ff">32</span>)
            msg_hex <span style="color:#f92672">=</span> msg<span style="color:#f92672">.</span>hex()
            <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> msg_hex:
                <span style="color:#66d9ef">if</span> c <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> permutation:
                    permutation <span style="color:#f92672">+=</span> c

        <span style="color:#66d9ef">return</span> permutation

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">recover_permutation</span>(seed_tree, secret_list):
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(N<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
            permutation <span style="color:#f92672">=</span> seed_to_permutation(seed_tree[i <span style="color:#f92672">+</span> N <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>])
            secret_list <span style="color:#f92672">=</span> [permutation[int(x, <span style="color:#ae81ff">16</span>)] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> secret_list]
        <span style="color:#66d9ef">return</span> secret_list

    seed_tree <span style="color:#f92672">=</span> seed_tree_gen(master_seed)
    base <span style="color:#f92672">=</span> pss_data<span style="color:#f92672">.</span>index(seed1)
    _, _, permutated_secret <span style="color:#f92672">=</span> parse_single(base)
    secret <span style="color:#f92672">=</span> recover_permutation(seed_tree, permutated_secret<span style="color:#f92672">.</span>hex())
    secret <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(secret)<span style="color:#f92672">.</span>encode()
    flag <span style="color:#f92672">=</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;WACON2023{&#34;</span> <span style="color:#f92672">+</span> secret <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;}&#39;</span>
    <span style="color:#66d9ef">assert</span> cascade_hash(flag, <span style="color:#ae81ff">0xbeeeef</span>, <span style="color:#ae81ff">32</span>)<span style="color:#f92672">.</span>hex() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;f7a5108a576391671fe3231040777e9ac455d1bb8b84a16b09be1b2bac68345c&#39;</span>
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;flag:&#34;</span>, flag)

<span style="color:#66d9ef">if</span> s <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
    seed2flag(<span style="color:#f92672">*</span>s)
</code></pre></div><pre><code>flag: b'WACON2023{2d4b7a9c085316ef}'
</code></pre>
<h2 id="3-232u">3. 232U</h2>
<p>我调用4核CPU大约是27429.81it/s，共需约5分钟爆破完，使用232U大约需要几秒钟。</p>
<pre><code>root@ctf-232u:~# python3 solve_final.py
 20%|█████████▌                                       | 1646570/8388608 [00:01&lt;00:05, 1319849.94it/s]
Found, exiting brute.
master_seed: b'\xa0\x00K\xfa\xef'
flag: b'WACON2023{2d4b7a9c085316ef}'
</code></pre><hr>
<p>本文同步发表于</p>
<ul>
<li>blog: ssst0n3.github.io</li>
<li>公众号: 石头的安全料理屋</li>
<li>知乎专栏: 石头的安全料理屋</li>
</ul>

            </div>
        </article>

        <hr />

        <div class="post-info">
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/st0n3">st0n3</a></span>
            <span>Based on <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>

    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      
      jax: ["input/TeX", "output/CommonHTML"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": { fonts: ["TeX"] },
      displayAlign: "left"
    });
  </script>

<script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_CHTML"></script>


</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4c3fb12a087ceed4a52cb5d57068a9795c7069617a01ca70f788052ad66e1791779e6c72686e1dc0ca13dc03b0203204b6566bb0dd1ee80de2b7ff4d8fe53db2.js" integrity="sha512-TD&#43;xKgh87tSlLLXVcGipeVxwaWF6Acpw94gFKtZuF5F3nmxyaG4dwMoT3AOwIDIEtlZrsN0e6A3it/9Nj&#43;U9sg=="></script>



    </body>
</html>
