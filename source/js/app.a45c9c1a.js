(function(){"use strict";var t={3211:function(t,e,n){var o=n(8935),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view",{staticClass:"ml-3"})],1)},a=[],r={name:"App",components:{}},s=r,l=n(1001),d=(0,l.Z)(s,i,a,!1,null,null,null),c=d.exports,u=n(8262),h=n(3266);n(44);const m="/api",f=`${m}/v1`,p="node",v="node_relation",b={v1:{node:`${f}/${p}`,node_relation:`${f}/${v}`}};var w={BaseUrl:"/",api:{v1:{node:{node:b.v1.node,list:t=>`${b.v1.node}/list/${t}`,matrix:t=>`${b.v1.node}/matrix/${t}`,update_markdown:t=>`${b.v1.node}/${t}`},node_relation:{list_by_root:t=>`${b.v1.node_relation}/${t}`,node_relation:b.v1.node_relation,update_node_relation_by_node:t=>`${b.v1.node_relation}/node/${t}`}}}},_=n(8372),x=n.n(_),g=n(2809),y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("RootNodes")],1)},k=[],M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-btn",{on:{click:function(e){return t.$bvModal.show("modal-create-root-node")}}},[n("b-icon",{attrs:{icon:"plus"}})],1),t._l(t.nodes,(function(e){return n("div",{key:e.id},[n("router-link",{attrs:{to:"/node/"+e.ID}},[t._v(t._s(e.markdown))])],1)})),n("b-modal",{attrs:{id:"modal-create-root-node","hide-footer":"",size:"xl"}},[n("b-form-group",{attrs:{id:"fieldset-horizontal","label-cols-sm":"4","label-cols-lg":"3","content-cols-sm":"","content-cols-lg":"7",description:"display in summary mode",label:"Title","label-for":"input-horizontal"}},[n("b-form-input",{model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),n("p",[t._v("markdown")]),n("MarkdownEditor",{ref:"create_root_node_markdown_editor",attrs:{markdown:""}}),n("div",{staticClass:"float-right",attrs:{id:"panel"}},[n("b-btn",{on:{click:t.createRootNode}},[t._v("save")])],1)],1)],2)},S=[],$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"previewer"}},[n("b-form-textarea",{attrs:{debounce:"300"},model:{value:t.edit,callback:function(e){t.edit=e},expression:"edit"}}),n("div",{attrs:{id:"preview"},domProps:{innerHTML:t._s(t.compiledMarkdown)}})],1)},I=[],C=n(2554),N={name:"MarkdownEditor",props:{markdown:String},data(){return{edit:this.markdown}},computed:{compiledMarkdown(){return(0,C.TU)(this.edit,{sanitize:!0})}}},T=N,R=(0,l.Z)(T,$,I,!1,null,"5ae0a58c",null),E=R.exports,D={name:"RootNodes",components:{MarkdownEditor:E},data(){return{nodes:[],title:""}},created(){this.listNodesByRoot()},methods:{async listNodesByRoot(){this.nodes=await x().api.get(w.api.v1.node.list(0),null,{caller:this})},async createRootNode(){let t=await x().api.post(w.api.v1.node.node,null,{title:this.title,markdown:this.$refs.create_root_node_markdown_editor.edit},{caller:this}),e=t.id;await x().api.post(w.api.v1.node_relation.node_relation,null,{root:this.root,node:e},{caller:this}),await x().api.post(w.api.v1.node_relation.node_relation,null,{root:this.root,node:e},{caller:this}),this.$bvModal.hide("modal-create-root-node")}}},L=D,O=(0,l.Z)(L,M,S,!1,null,"16d82c23",null),B=O.exports,j={name:"IndexView",components:{RootNodes:B}},Z=j,A=(0,l.Z)(Z,y,k,!1,null,"c455c148",null),V=A.exports,P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("NodeMatrix",{attrs:{"static-view":"","data-source":"/"+t.source+"/"+t.dataSource}})],1)},U=[],z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[t.staticView?t._e():n("b-button",{staticClass:"download-btn",on:{click:t.downloadDataSource}},[n("b-icon",{attrs:{icon:"download"}})],1),n("TableOfContent",{attrs:{toc:t.toc}}),n("b-toast",{attrs:{id:"my-toast",variant:"warning",solid:"","no-auto-hide":"",visible:t.loading},scopedSlots:t._u([{key:"toast-title",fn:function(){return[n("div",{staticClass:"d-flex flex-grow-1 align-items-baseline"},[n("b-img",{staticClass:"mr-2",attrs:{blank:"","blank-color":"#ff5555",width:"12",height:"12"}}),n("strong",{staticClass:"mr-auto"},[t._v("Loading")]),n("small",{staticClass:"text-muted mr-2"},[t._v("42 seconds ago")])],1)]},proxy:!0}])},[n("b-spinner")],1),t._l(t.nodeMatrix,(function(e,o){return n("div",{key:"col-"+o,staticClass:"mt-5",staticStyle:{"white-space":"nowrap"}},t._l(e,(function(e,i){return n("div",{key:"col-"+o+"-row-"+i,ref:"node-"+e.ID,refInFor:!0,staticClass:"ml-5",class:{hidden:0===e.ID},staticStyle:{display:"inline-block",width:"500px","vertical-align":"middle"},attrs:{id:"node-"+e.ID},on:{mouseover:t.mouseover}},[-1!==e.ID?n("div",[n("b-tooltip",{attrs:{offset:"-200",boundary:"document",placement:"top",target:"node-"+e.ID,variant:"light",triggers:"hover"}},[n("div",[0!==e.next?n("b-btn",{attrs:{variant:"light"}},[n("a",{attrs:{href:"#card-"+e.next},on:{click:function(n){return n.preventDefault(),t.anchor("card-"+e.next)}}},[t._v("Next")])]):t.staticView?t._e():n("b-btn",{on:{click:function(n){return t.next(e.ID)}}},[t._v("Next")]),0!==e.child?n("b-btn",{staticClass:"ml-2",attrs:{variant:"light"}},[n("a",{attrs:{href:"#card-"+e.child},on:{click:function(n){return n.preventDefault(),t.anchor("card-"+e.child)}}},[t._v("Call")])]):t.staticView?t._e():n("b-btn",{staticClass:"ml-2",on:{click:function(n){return t.call(e.ID)}}},[t._v("Call")]),void 0!==e.parent?n("b-btn",{staticClass:"ml-2",attrs:{variant:"light"}},[n("a",{attrs:{href:"#card-"+e.parent},on:{click:function(n){return n.preventDefault(),t.anchor("card-"+e.parent)}}},[t._v("Parent")])]):t._e()],1)]),e.markdown.length>0?n("MarkdownCard",{staticStyle:{"white-space":"normal"},attrs:{nodeId:e.ID.toString(),id:"card-"+e.ID,markdown:e.markdown.toString()},on:{update_node:t.refreshWorld}}):n("AnalysisItem")],1):t._e()])})),0)})),t.staticView?t._e():n("b-modal",{attrs:{id:"node-common","hide-footer":"",size:"xl"}},[n("MarkdownEditor",{ref:"markdown_editor_common",attrs:{markdown:""}}),n("div",{staticClass:"float-right",attrs:{id:"panel"}},[n("b-btn",{on:{click:t.save}},[t._v("save")])],1)],1)],2)},W=[];function H(t){let e=[],n={h1:1,h2:1,h3:1,h4:1,h5:1,h6:1};function o(t){if(1===t.nodeType&&"script"!==t.nodeName)if(Object.prototype.hasOwnProperty.call(n,t.nodeName.toLowerCase()))null===t.getAttribute("class")&&e.push(t);else for(let e=0;e<t.childNodes.length;e++)o(t.childNodes[e])}return o(t),e}function F(t){let e=(0,C.TU)(t),n=document.createElement("div");return n.innerHTML=e,H(n)}class G{constructor(t,e,n){this.x=1,this.y=1,this.toc=[],this.matrix=[[t]],this.nodes=e,this.nodeRelations=n,this.nextRecursive(t)}nextRecursive(t){if(0===t)return;let e=this.nodeRelations[t];if(0===e.next){for(let t=this.matrix[this.x-1].length;t<this.y;t++)this.matrix[this.x-1].push(0);return}this.matrix[this.matrix.length-1].push(e.next);let n=this.matrix[this.matrix.length-1].length;if(n>this.y){for(let t=0;t<this.x-1;t++)this.matrix[t].push(0);this.y=n}this.nextRecursive(e.next)}childRecursive(t){for(let e=this.y-1;e>=0;e--){let n=this.matrix[t][e];if(0===n)continue;let o=this.nodeRelations[n];if(0===o.child)continue;let i=new Array(e).fill(0);i.push(o.child),this.matrix.push(i),this.x+=1,this.nextRecursive(o.child),this.childRecursive(this.x-1)}}shift(){for(let t=2;t<=this.x-1;t++){let e=-1,n=-1;for(let o=0;o<=this.y-1;o++)this.matrix[t][o]>0&&(-1!==e?n=o:(e=o,n=e)),0!==this.matrix[t][o]&&o!==this.y-1||(-1!==e&&this.shiftLine(t,e,n),e=-1,n=-1)}}shiftLine(t,e,n){let o=0;for(let i=e;i<=n;i++){let e=t;while(e>0)if(e--,0!==this.matrix[e][i]){e+=1;break}if(e===t)return;(0===o||o>t-e)&&(o=t-e)}if(o>0)for(let i=e;i<=n;i++)this.matrix[t-o][i]=this.matrix[t][i],this.matrix[t][i]=0}cleanSuffix(){for(let t=0;t<=this.y-1;t++)for(let e=this.x-1;e>=0;e--){if(this.matrix[e][t]>0)break;this.matrix[e][t]=-1}}print(){for(let t=0;t<=this.y-1;t++){for(let e=0;e<=this.x-1;e++)process.stdout.write(this.matrix[e][t].toString());process.stdout.write("\n")}}dumpNode(){let t=[[]];for(let e=0;e<=this.y-1;e++){let n=[];for(let t=0;t<=this.x-1;t++){let o=this.matrix[t][e],i=this.nodes[o];if(o>0){let t=this.nodeRelations[o];if(i.child=t.child,i.next=t.next,i.child>0){let t=this.nodes[i.child];t.parent=o}}else i={ID:o,markdown:""};n.push(i)}t.push(n)}return t}generateToc(t){if(0===t)return;let e=this.nodes[t],n=F(e.markdown);n.forEach((t=>{let e={nodeName:t.nodeName,innerText:t.innerText,id:t.id};this.toc.push(e)}));let o=this.nodeRelations[t];o.child>0&&this.generateToc(o.child),o.next>0&&this.generateToc(o.next)}}var J={Matrix:G},X=n(3191),q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-card",[n("div",{staticStyle:{width:"100%"},domProps:{innerHTML:t._s(t.markdownToHtml)},on:{dblclick:function(e){return t.$bvModal.show("modal-node-"+t.nodeId)}}})]),n("b-modal",{attrs:{id:"modal-node-"+t.nodeId,"hide-footer":"",size:"xl"}},[n("MarkdownEditor",{ref:"markdown_editor",attrs:{markdown:t.markdown}}),n("div",{staticClass:"float-right",attrs:{id:"panel"}},[n("b-btn",{on:{click:t.save}},[t._v("save")])],1)],1)],1)},K=[],Q={name:"MarkdownCard",components:{MarkdownEditor:E},props:{nodeId:String,markdown:String},data(){return{}},computed:{markdownToHtml(){return(0,C.TU)(this.markdown)}},methods:{async save(){await x().api.put(w.api.v1.node.update_markdown(this.nodeId),null,{markdown:this.$refs.markdown_editor.edit},{caller:this,success_msg:"update successfully"}),this.$bvModal.hide("modal-node-"+this.nodeId),this.$emit("update_node")}}},Y=Q,tt=(0,l.Z)(Y,q,K,!1,null,"18c30a6e",null),et=tt.exports,nt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-card",{staticClass:"mb-2",attrs:{tag:"article"}},[n("b-card-title",[t._v(" WithMounts() ")]),n("b-card-sub-title",[n("b-link",{staticClass:"card-link",attrs:{href:"#"}},[n("b-icon-github")],1)],1),n("b-card-body",[n("b-card-text",[t._v(" "+t._s(t.note)+" ")]),n("pre",[t._v(" "+t._s(t.code)+" ")])],1)],1)],1)},ot=[],it={name:"AnalysisItem",props:{note:String,link:String,code:String},data(){return{}}},at=it,rt=(0,l.Z)(at,nt,ot,!1,null,"6df6b935",null),st=rt.exports,lt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("SideBar",{attrs:{toc:t.toc}})],1)},dt=[],ct=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.sidebar-toc",modifiers:{"sidebar-toc":!0}}],staticClass:"toc-btn"},[n("b-icon",{attrs:{icon:"justify"}})],1),n("b-sidebar",{attrs:{id:"sidebar-toc",title:"Toc",right:"",visible:"",shadow:""}},[n("div",{staticClass:"px-3 py-2"},[n("ul",t._l(t.toc,(function(e,o){return n("li",{key:"header-"+o,class:"toc-"+e.nodeName.toLowerCase()},[n("a",{attrs:{href:"#"+e.id},on:{click:function(n){return n.preventDefault(),t.anchor(e.id)}}},[t._v(t._s(e.innerText))])])})),0)])])],1)},ut=[];function ht(t){let e=document.getElementById(t);e&&e.scrollIntoView()}var mt={name:"SideBar",props:{toc:Array},methods:{anchor:ht}},ft=mt,pt=(0,l.Z)(ft,ct,ut,!1,null,"37e781ab",null),vt=pt.exports,bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("label",{staticClass:"collapse btn btn-secondary toc-btn",attrs:{for:"_1"}},[n("b-icon",{attrs:{icon:"justify"}})],1),n("input",{attrs:{id:"_1",type:"radio",name:"c1"}}),n("b-sidebar",{attrs:{id:"sidebar-toc",title:"Toc",right:"",shadow:"",visible:""},scopedSlots:t._u([{key:"header",fn:function(){return[n("label",{staticClass:"collapse",attrs:{for:"_2"}},[n("b-icon",{attrs:{icon:"x",variant:"secondary"}})],1),n("input",{attrs:{id:"_2",type:"radio",name:"c1"}})]},proxy:!0}])},[n("div",{staticClass:"px-3 py-2"},[n("ul",t._l(t.toc,(function(e,o){return n("li",{key:"header-"+o,class:"toc-"+e.nodeName.toLowerCase()},[n("a",{attrs:{href:"#"+e.id}},[t._v(t._s(e.innerText))])])})),0)])])],1)},wt=[],_t={name:"SideBarStatic",props:{toc:Array}},xt=_t,gt=(0,l.Z)(xt,bt,wt,!1,null,"07a09ed6",null),yt=gt.exports,kt={name:"TableOfContent",components:{SideBarStatic:yt,SideBar:vt},props:{toc:Array},data(){return{headings:[{nodeName:"h1",innerText:"heading"}]}},mounted(){},methods:{}},Mt=kt,St=(0,l.Z)(Mt,lt,dt,!1,null,"0a2d7d3f",null),$t=St.exports;const It=1,Ct=2;var Nt={name:"NodeMatrix",components:{TableOfContent:$t,AnalysisItem:st,MarkdownCard:et,MarkdownEditor:E},props:{root:Number,staticView:Boolean,dataSource:String},data(){return{nodesMap:{},nodeRelationsMap:{},nodeMatrix:[],mode:0,baseNode:0,plumbInstance:null,nodeLoading:!1,nodeRelationsLoading:!1,toc:[],time_start:0}},computed:{loading(){return this.nodeLoading||this.nodeRelationsLoading}},async created(){this.time_start=(new Date).getTime(),await this.refreshData()},mounted(){this.plumbInstance=X.jsPlumb.getInstance(),this.plumbInstance.bind("click",(function(t){window.scrollTo(t.target.offsetLeft-100,t.target.offsetTop-100)}))},destroyed(){this.plumbInstance.deleteEveryConnection(),this.plumbInstance.deleteEveryEndpoint()},watch:{nodeMatrix:async function(){this.$nextTick((()=>{this.drawLine()}))}},methods:{anchor:ht,downloadDataSource(){let t={matrix:this.nodeMatrix,toc:this.toc},e=JSON.stringify(t);const n=window.URL.createObjectURL(new Blob([e]));let o=document.createElement("a");o.href=n,o.setAttribute("download","data-source.json"),document.body.appendChild(o),o.click()},async refreshData(){if(this.staticView){let t=await x().api.get(this.dataSource,null,{caller:this,success_msg:"list node matrix successfully"});return this.nodeMatrix=t["matrix"],void(this.toc=t["toc"])}console.log("time before data pulled is",(new Date).getTime()-this.time_start+"ms"),await this.listNodes(this.root),await this.listNodeRelationsByRoot(this.root),console.log("time after data pulled is",(new Date).getTime()-this.time_start+"ms");let t=new J.Matrix(this.root,this.nodesMap,this.nodeRelationsMap);t.childRecursive(0),t.shift(),t.cleanSuffix(),this.nodeMatrix=t.dumpNode(),t.generateToc(this.root),this.toc=t.toc},async refreshWorld(){this.plumbInstance.deleteEveryConnection(),this.plumbInstance.deleteEveryEndpoint(),await this.refreshData()},async save(){let t=await x().api.post(w.api.v1.node.node,null,{markdown:this.$refs.markdown_editor_common.edit},{caller:this}),e=t.id,n={};this.mode===Ct?n.child=e:this.mode===It&&(n.next=e),await x().api.post(w.api.v1.node_relation.node_relation,null,{root:this.root,node:e},{caller:this}),await x().api.put(w.api.v1.node_relation.update_node_relation_by_node(this.baseNode),null,n,{caller:this}),this.$bvModal.hide("node-common"),await this.refreshWorld()},next(t){this.baseNode=t,this.mode=It,this.$bvModal.show("node-common")},call(t){this.baseNode=t,this.mode=Ct,this.$bvModal.show("node-common")},mouseover(){console.log("mouseover")},drawLine(){let t=this;t.plumbInstance.ready((function(){for(let e=0;e<t.nodeMatrix.length;e++)for(let n=0;n<t.nodeMatrix[e].length;n++){let o=t.nodeMatrix[e][n];o.ID<=0||(0!==o.child&&t.plumbInstance.connect({source:"node-"+o.ID,target:"node-"+o.child,anchor:["Right","Left"],endpoint:"Blank",connector:["Straight"],overlays:[["Arrow",{width:16,length:16,location:1}]],paintStyle:{stroke:"#909393",strokeWidth:2}}),0!==o.next&&t.plumbInstance.connect({source:"node-"+o.ID,target:"node-"+o.next,anchor:["Bottom","Top"],endpoint:"Blank",connector:["Straight"],overlays:[["Arrow",{width:16,length:16,location:1}]],paintStyle:{stroke:"#909393",strokeWidth:2}}))}})),console.log("time after line drawn cost is",(new Date).getTime()-this.time_start+"ms")},async listNodes(t){this.nodeLoading=!0;let e=await x().api.get(w.api.v1.node.list(t),null,{caller:this,success_msg:"list node successfully"});e.forEach((t=>{this.nodesMap[t.ID]=t})),this.nodeLoading=!1},async listNodeRelationsByRoot(t){this.nodeRelationsLoading=!0;let e=await x().api.get(w.api.v1.node_relation.list_by_root(t),null,{caller:this,success_msg:"list node_relation successfully"});e.forEach((t=>{this.nodeRelationsMap[t.node]=t})),this.nodeRelationsLoading=!1}}},Tt=Nt,Rt=(0,l.Z)(Tt,z,W,!1,null,"9556e920",null),Et=Rt.exports,Dt={name:"StaticView",components:{NodeMatrix:Et},data(){return{dataSource:this.$route.params.data_source,source:this.$route.params.source}},created(){x().api.initClient("/")}},Lt=Dt,Ot=(0,l.Z)(Lt,P,U,!1,null,"912daf0c",null),Bt=Ot.exports,jt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("NodeMatrix",{attrs:{root:t.root}})],1)},Zt=[],At={name:"DynamicView",components:{NodeMatrix:Et},data(){return{root:parseInt(this.$route.params.id)}}},Vt=At,Pt=(0,l.Z)(Vt,jt,Zt,!1,null,"54656367",null),Ut=Pt.exports;o["default"].use(g.Z);var zt=new g.Z({routes:[{path:"/",name:"IndexView",component:V},{path:"/node/:id",name:"NodeMatrix",component:Ut},{path:"/static/:source/:data_source",name:"StaticView",component:Bt}]});o["default"].use(u.XG7),o["default"].use(h.A7),x().api.initClient(w.BaseUrl),o["default"].config.productionTip=!1,new o["default"]({router:zt,render:t=>t(c)}).$mount("#app")}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}n.m=t,function(){var t=[];n.O=function(e,o,i,a){if(!o){var r=1/0;for(c=0;c<t.length;c++){o=t[c][0],i=t[c][1],a=t[c][2];for(var s=!0,l=0;l<o.length;l++)(!1&a||r>=a)&&Object.keys(n.O).every((function(t){return n.O[t](o[l])}))?o.splice(l--,1):(s=!1,a<r&&(r=a));if(s){t.splice(c--,1);var d=i();void 0!==d&&(e=d)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[o,i,a]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,o){var i,a,r=o[0],s=o[1],l=o[2],d=0;if(r.some((function(e){return 0!==t[e]}))){for(i in s)n.o(s,i)&&(n.m[i]=s[i]);if(l)var c=l(n)}for(e&&e(o);d<r.length;d++)a=r[d],n.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return n.O(c)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(3211)}));o=n.O(o)})();
//# sourceMappingURL=app.a45c9c1a.js.map