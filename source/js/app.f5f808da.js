(function(){"use strict";var t={2165:function(t,e,o){var n=o(8935),i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("router-view",{staticClass:"ml-3"})],1)},a=[],r={name:"App",components:{}},s=r,l=o(1001),d=(0,l.Z)(s,i,a,!1,null,null,null),c=d.exports,u=o(8262),h=o(3266);o(44);const m="/api",p=`${m}/v1`,f="node",v="node_relation",b={v1:{node:`${p}/${f}`,node_relation:`${p}/${v}`}};var _={BaseUrl:"/",api:{v1:{node:{node:b.v1.node,list:t=>`${b.v1.node}/list/${t}`,matrix:t=>`${b.v1.node}/matrix/${t}`,update_markdown:t=>`${b.v1.node}/${t}`},node_relation:{list_by_root:t=>`${b.v1.node_relation}/${t}`,node_relation:b.v1.node_relation,update_node_relation_by_node:t=>`${b.v1.node_relation}/node/${t}`}}}},w=o(8372),x=o.n(w),g=o(2809),y=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("RootNodes")],1)},k=[],M=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-btn",{on:{click:function(e){return t.$bvModal.show("modal-create-root-node")}}},[o("b-icon",{attrs:{icon:"plus"}})],1),t._l(t.nodes,(function(e){return o("div",{key:e.id},[o("router-link",{attrs:{to:"/node/"+e.ID}},[t._v(t._s(e.markdown))])],1)})),o("b-modal",{attrs:{id:"modal-create-root-node","hide-footer":"",size:"xl"}},[o("b-form-group",{attrs:{id:"fieldset-horizontal","label-cols-sm":"4","label-cols-lg":"3","content-cols-sm":"","content-cols-lg":"7",description:"display in summary mode",label:"Title","label-for":"input-horizontal"}},[o("b-form-input",{model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),o("p",[t._v("markdown")]),o("MarkdownEditor",{ref:"create_root_node_markdown_editor",attrs:{markdown:""}}),o("div",{staticClass:"float-right",attrs:{id:"panel"}},[o("b-btn",{on:{click:t.createRootNode}},[t._v("save")])],1)],1)],2)},$=[],S=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"previewer"}},[o("b-form-textarea",{attrs:{debounce:"300"},model:{value:t.edit,callback:function(e){t.edit=e},expression:"edit"}}),o("div",{attrs:{id:"preview"},domProps:{innerHTML:t._s(t.compiledMarkdown)}})],1)},C=[],I=o(2554),N={name:"MarkdownEditor",props:{markdown:String},data(){return{edit:this.markdown}},computed:{compiledMarkdown(){return(0,I.TU)(this.edit,{sanitize:!0})}}},R=N,T=(0,l.Z)(R,S,C,!1,null,"eacb15d0",null),E=T.exports,L={name:"RootNodes",components:{MarkdownEditor:E},data(){return{nodes:[],title:""}},created(){this.listNodesByRoot()},methods:{async listNodesByRoot(){this.nodes=await x().api.get(_.api.v1.node.list(0),null,{caller:this})},async createRootNode(){let t=await x().api.post(_.api.v1.node.node,null,{title:this.title,markdown:this.$refs.create_root_node_markdown_editor.edit},{caller:this}),e=t.id;await x().api.post(_.api.v1.node_relation.node_relation,null,{root:this.root,node:e},{caller:this}),await x().api.post(_.api.v1.node_relation.node_relation,null,{root:this.root,node:e},{caller:this}),this.$bvModal.hide("create_root_node_markdown_editor")}}},D=L,O=(0,l.Z)(D,M,$,!1,null,"4cf3cab2",null),B=O.exports,j={name:"IndexView",components:{RootNodes:B}},Z=j,A=(0,l.Z)(Z,y,k,!1,null,"c455c148",null),P=A.exports,U=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("NodeMatrix",{attrs:{static:"","data-source":"/source/"+t.dataSource}})],1)},z=[],W=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-button",{staticClass:"download-btn",on:{click:t.downloadDataSource}},[o("b-icon",{attrs:{icon:"download"}})],1),o("TableOfContent",{attrs:{toc:t.toc}}),o("b-toast",{attrs:{id:"my-toast",variant:"warning",solid:"","no-auto-hide":"",visible:t.loading},scopedSlots:t._u([{key:"toast-title",fn:function(){return[o("div",{staticClass:"d-flex flex-grow-1 align-items-baseline"},[o("b-img",{staticClass:"mr-2",attrs:{blank:"","blank-color":"#ff5555",width:"12",height:"12"}}),o("strong",{staticClass:"mr-auto"},[t._v("Loading")]),o("small",{staticClass:"text-muted mr-2"},[t._v("42 seconds ago")])],1)]},proxy:!0}])},[o("b-spinner")],1),t._l(t.nodeMatrix,(function(e,n){return o("div",{key:"col-"+n,staticClass:"mt-5",staticStyle:{"white-space":"nowrap"}},t._l(e,(function(e,i){return o("div",{key:"col-"+n+"-row-"+i,ref:"node-"+e.ID,refInFor:!0,staticClass:"ml-5",class:{hidden:0===e.ID},staticStyle:{display:"inline-block",width:"500px","vertical-align":"middle"},attrs:{id:"node-"+e.ID},on:{mouseover:t.mouseover}},[o("b-tooltip",{attrs:{offset:"-200",boundary:"document",placement:"top",target:"node-"+e.ID,variant:"light",triggers:"hover"}},[o("div",[0===e.next?o("b-btn",{on:{click:function(o){return t.next(e.ID)}}},[t._v("Next")]):o("b-btn",{attrs:{variant:"light"}},[o("a",{attrs:{href:"#card-"+e.next}},[t._v("Next")])]),0===e.child?o("b-btn",{staticClass:"ml-2",on:{click:function(o){return t.call(e.ID)}}},[t._v("Call")]):o("b-btn",{staticClass:"ml-2",attrs:{variant:"light"}},[o("a",{attrs:{href:"#card-"+e.child}},[t._v("Call")])])],1)]),e.markdown.length>0?o("MarkdownCard",{staticStyle:{"white-space":"normal"},attrs:{nodeId:e.ID.toString(),id:"card-"+e.ID,markdown:e.markdown.toString()},on:{update_node:t.refreshWorld}}):o("AnalysisItem")],1)})),0)})),o("b-modal",{attrs:{id:"node-common","hide-footer":"",size:"xl"}},[o("MarkdownEditor",{ref:"markdown_editor_common",attrs:{markdown:""}}),o("div",{staticClass:"float-right",attrs:{id:"panel"}},[o("b-btn",{on:{click:t.save}},[t._v("save")])],1)],1)],2)},H=[];function V(t){let e=[],o={h1:1,h2:1,h3:1,h4:1,h5:1,h6:1};function n(t){if(1===t.nodeType&&"script"!==t.nodeName)if(Object.prototype.hasOwnProperty.call(o,t.nodeName.toLowerCase()))null===t.getAttribute("class")&&e.push(t);else for(let e=0;e<t.childNodes.length;e++)n(t.childNodes[e])}return n(t),e}function F(t){let e=(0,I.TU)(t),o=document.createElement("div");return o.innerHTML=e,V(o)}class G{constructor(t,e,o){this.x=1,this.y=1,this.toc=[],this.matrix=[[t]],this.nodes=e,this.nodeRelations=o,this.nextRecursive(t)}nextRecursive(t){if(0===t)return;let e=this.nodeRelations[t];if(0===e.next){for(let t=this.matrix[this.x-1].length;t<this.y;t++)this.matrix[this.x-1].push(0);return}this.matrix[this.matrix.length-1].push(e.next);let o=this.matrix[this.matrix.length-1].length;if(o>this.y){for(let t=0;t<this.x-1;t++)this.matrix[t].push(0);this.y=o}this.nextRecursive(e.next)}childRecursive(t){for(let e=this.y-1;e>=0;e--){let o=this.matrix[t][e];if(0===o)continue;let n=this.nodeRelations[o];if(0===n.child)continue;let i=new Array(e).fill(0);i.push(n.child),this.matrix.push(i),this.x+=1,this.nextRecursive(n.child),this.childRecursive(this.x-1)}}print(){for(let t=0;t<=this.y-1;t++){for(let e=0;e<=this.x-1;e++)process.stdout.write(this.matrix[e][t].toString());process.stdout.write("\n")}}dumpNode(){let t=[[]];for(let e=0;e<=this.y-1;e++){let o=[];for(let t=0;t<=this.x-1;t++){let n=this.matrix[t][e],i=this.nodes[n];if(n>0){let t=this.nodeRelations[n];i.child=t.child,i.next=t.next}else i={ID:0,markdown:""};o.push(i)}t.push(o)}return t}generateToc(t){if(0===t)return;let e=this.nodes[t],o=F(e.markdown);o.forEach((t=>{let e={nodeName:t.nodeName,innerText:t.innerText};this.toc.push(e)}));let n=this.nodeRelations[t];n.child>0&&this.generateToc(n.child),n.next>0&&this.generateToc(n.next)}}var J={Matrix:G},X=o(3191),q=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-card",[o("div",{staticStyle:{width:"100%"},domProps:{innerHTML:t._s(t.markdownToHtml)},on:{dblclick:function(e){return t.$bvModal.show("modal-node-"+t.nodeId)}}})]),o("b-modal",{attrs:{id:"modal-node-"+t.nodeId,"hide-footer":"",size:"xl"}},[o("MarkdownEditor",{ref:"markdown_editor",attrs:{markdown:t.markdown}}),o("div",{staticClass:"float-right",attrs:{id:"panel"}},[o("b-btn",{on:{click:t.save}},[t._v("save")])],1)],1)],1)},K=[],Q={name:"MarkdownCard",components:{MarkdownEditor:E},props:{nodeId:String,markdown:String},data(){return{}},computed:{markdownToHtml(){return(0,I.TU)(this.markdown)}},methods:{async save(){await x().api.put(_.api.v1.node.update_markdown(this.nodeId),null,{markdown:this.$refs.markdown_editor.edit},{caller:this,success_msg:"update successfully"}),this.$bvModal.hide("modal-node-"+this.nodeId),this.$emit("update_node")}}},Y=Q,tt=(0,l.Z)(Y,q,K,!1,null,"18c30a6e",null),et=tt.exports,ot=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-card",{staticClass:"mb-2",attrs:{tag:"article"}},[o("b-card-title",[t._v(" WithMounts() ")]),o("b-card-sub-title",[o("b-link",{staticClass:"card-link",attrs:{href:"#"}},[o("b-icon-github")],1)],1),o("b-card-body",[o("b-card-text",[t._v(" "+t._s(t.note)+" ")]),o("pre",[t._v(" "+t._s(t.code)+" ")])],1)],1)],1)},nt=[],it={name:"AnalysisItem",props:{note:String,link:String,code:String},data(){return{}}},at=it,rt=(0,l.Z)(at,ot,nt,!1,null,"6df6b935",null),st=rt.exports,lt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("SideBar",{attrs:{toc:t.toc}})],1)},dt=[],ct=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.sidebar-toc",modifiers:{"sidebar-toc":!0}}],staticClass:"toc-btn"},[o("b-icon",{attrs:{icon:"justify"}})],1),o("b-sidebar",{attrs:{id:"sidebar-toc",title:"Toc",right:"",shadow:""}},[o("div",{staticClass:"px-3 py-2"},[o("ul",t._l(t.toc,(function(e,n){return o("li",{key:"header-"+n,class:"toc-"+e.nodeName.toLowerCase()},[o("a",{attrs:{href:"#"+e.id}},[t._v(t._s(e.innerText))])])})),0)])])],1)},ut=[],ht={name:"SideBar",props:{toc:Array}},mt=ht,pt=(0,l.Z)(mt,ct,ut,!1,null,"e11740a8",null),ft=pt.exports,vt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("label",{staticClass:"collapse btn btn-secondary toc-btn",attrs:{for:"_1"}},[o("b-icon",{attrs:{icon:"justify"}})],1),o("input",{attrs:{id:"_1",type:"radio",name:"c1"}}),o("b-sidebar",{attrs:{id:"sidebar-toc",title:"Toc",right:"",shadow:"",visible:""},scopedSlots:t._u([{key:"header",fn:function(){return[o("label",{staticClass:"collapse",attrs:{for:"_2"}},[o("b-icon",{attrs:{icon:"x",variant:"secondary"}})],1),o("input",{attrs:{id:"_2",type:"radio",name:"c1"}})]},proxy:!0}])},[o("div",{staticClass:"px-3 py-2"},[o("ul",t._l(t.toc,(function(e,n){return o("li",{key:"header-"+n,class:"toc-"+e.nodeName.toLowerCase()},[o("a",{attrs:{href:"#"+e.id}},[t._v(t._s(e.innerText))])])})),0)])])],1)},bt=[],_t={name:"SideBarStatic",props:{toc:Array}},wt=_t,xt=(0,l.Z)(wt,vt,bt,!1,null,"07a09ed6",null),gt=xt.exports,yt={name:"TableOfContent",components:{SideBarStatic:gt,SideBar:ft},props:{toc:Array},data(){return{headings:[{nodeName:"h1",innerText:"heading"}]}},mounted(){},methods:{}},kt=yt,Mt=(0,l.Z)(kt,lt,dt,!1,null,"0a2d7d3f",null),$t=Mt.exports;const St=1,Ct=2;var It={name:"NodeMatrix",components:{TableOfContent:$t,AnalysisItem:st,MarkdownCard:et,MarkdownEditor:E},props:{root:Number,static:Boolean,dataSource:String},data(){return{nodesMap:{},nodeRelationsMap:{},nodeMatrix:[],mode:0,baseNode:0,plumbInstance:null,nodeLoading:!1,nodeRelationsLoading:!1,toc:[]}},computed:{loading(){return this.nodeLoading||this.nodeRelationsLoading}},async created(){await this.refreshData()},mounted(){this.plumbInstance=X.jsPlumb.getInstance(),this.plumbInstance.bind("click",(function(t){window.scrollTo(t.target.offsetLeft-100,t.target.offsetTop-100)}))},destroyed(){this.plumbInstance.deleteEveryConnection(),this.plumbInstance.deleteEveryEndpoint()},watch:{nodeMatrix:async function(){this.$nextTick((()=>{this.drawLine()}))}},methods:{downloadDataSource(){let t={matrix:this.nodeMatrix,toc:this.toc},e=JSON.stringify(t);const o=window.URL.createObjectURL(new Blob([e]));let n=document.createElement("a");n.href=o,n.setAttribute("download","data-source.json"),document.body.appendChild(n),n.click()},async refreshData(){if(this.static){let t=await x().api.get(this.dataSource,null,{caller:this,success_msg:"list node matrix successfully"});return this.nodeMatrix=t["matrix"],void(this.toc=t["toc"])}await this.listNodes(this.root),await this.listNodeRelationsByRoot(this.root);let t=new J.Matrix(this.root,this.nodesMap,this.nodeRelationsMap);t.childRecursive(0),this.nodeMatrix=t.dumpNode(),t.generateToc(this.root),this.toc=t.toc},async refreshWorld(){this.plumbInstance.deleteEveryConnection(),this.plumbInstance.deleteEveryEndpoint(),await this.refreshData()},async save(){let t=await x().api.post(_.api.v1.node.node,null,{markdown:this.$refs.markdown_editor_common.edit},{caller:this}),e=t.id,o={};this.mode===Ct?o.child=e:this.mode===St&&(o.next=e),await x().api.post(_.api.v1.node_relation.node_relation,null,{root:this.root,node:e},{caller:this}),await x().api.put(_.api.v1.node_relation.update_node_relation_by_node(this.baseNode),null,o,{caller:this}),this.$bvModal.hide("node-common"),await this.refreshWorld()},next(t){this.baseNode=t,this.mode=St,this.$bvModal.show("node-common")},call(t){this.baseNode=t,this.mode=Ct,this.$bvModal.show("node-common")},mouseover(){console.log("mouseover")},drawLine(){let t=this;t.plumbInstance.ready((function(){for(let e=0;e<t.nodeMatrix.length;e++)for(let o=0;o<t.nodeMatrix[e].length;o++){let n=t.nodeMatrix[e][o];0!==n.ID&&(0!==n.child&&t.plumbInstance.connect({source:"node-"+n.ID,target:"node-"+n.child,anchor:["Right","Left"],endpoint:"Blank",connector:["Straight"],overlays:[["Arrow",{width:16,length:16,location:1}]],paintStyle:{stroke:"#909393",strokeWidth:2}}),0!==n.next&&t.plumbInstance.connect({source:"node-"+n.ID,target:"node-"+n.next,anchor:["Bottom","Top"],endpoint:"Blank",connector:["Straight"],overlays:[["Arrow",{width:16,length:16,location:1}]],paintStyle:{stroke:"#909393",strokeWidth:2}}))}}))},async listNodes(t){this.nodeLoading=!0;let e=await x().api.get(_.api.v1.node.list(t),null,{caller:this,success_msg:"list node successfully"});e.forEach((t=>{this.nodesMap[t.ID]=t})),this.nodeLoading=!1},async listNodeRelationsByRoot(t){this.nodeRelationsLoading=!0;let e=await x().api.get(_.api.v1.node_relation.list_by_root(t),null,{caller:this,success_msg:"list node_relation successfully"});e.forEach((t=>{this.nodeRelationsMap[t.node]=t})),this.nodeRelationsLoading=!1}}},Nt=It,Rt=(0,l.Z)(Nt,W,H,!1,null,"7abee957",null),Tt=Rt.exports,Et={name:"StaticView",components:{NodeMatrix:Tt},data(){return{dataSource:this.$route.params.data_source}},created(){x().api.initClient("/")}},Lt=Et,Dt=(0,l.Z)(Lt,U,z,!1,null,"39a47651",null),Ot=Dt.exports,Bt=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("NodeMatrix",{attrs:{root:t.root}})],1)},jt=[],Zt={name:"DynamicView",components:{NodeMatrix:Tt},data(){return{root:parseInt(this.$route.params.id)}}},At=Zt,Pt=(0,l.Z)(At,Bt,jt,!1,null,"54656367",null),Ut=Pt.exports;n["default"].use(g.Z);var zt=new g.Z({routes:[{path:"/",name:"IndexView",component:P},{path:"/node/:id",name:"NodeMatrix",component:Ut},{path:"/static/:data_source",name:"StaticView",component:Ot}]});n["default"].use(u.XG7),n["default"].use(h.A7),x().api.initClient(_.BaseUrl),n["default"].config.productionTip=!1,new n["default"]({router:zt,render:t=>t(c)}).$mount("#app")}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,o),a.exports}o.m=t,function(){var t=[];o.O=function(e,n,i,a){if(!n){var r=1/0;for(c=0;c<t.length;c++){n=t[c][0],i=t[c][1],a=t[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&a||r>=a)&&Object.keys(o.O).every((function(t){return o.O[t](n[l])}))?n.splice(l--,1):(s=!1,a<r&&(r=a));if(s){t.splice(c--,1);var d=i();void 0!==d&&(e=d)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[n,i,a]}}(),function(){o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,{a:e}),e}}(),function(){o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};o.O.j=function(e){return 0===t[e]};var e=function(e,n){var i,a,r=n[0],s=n[1],l=n[2],d=0;if(r.some((function(e){return 0!==t[e]}))){for(i in s)o.o(s,i)&&(o.m[i]=s[i]);if(l)var c=l(o)}for(e&&e(n);d<r.length;d++)a=r[d],o.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return o.O(c)},n=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(2165)}));n=o.O(n)})();
//# sourceMappingURL=app.f5f808da.js.map